function assetsLoaded(n){corridor.addComponent(new Appearance(new THREE.Mesh(n,new THREE.MeshPhongMaterial({color:8947848}))))}function update(n){world.update(n)}function frame(){for(now=window.performance.now(),dt+=Math.min(1,(now-last)/1e3);dt>step;)dt-=step,update(step);last=now,window.requestAnimationFrame(frame)}var now,dt=0,last=window.performance.now(),step=1/60,scene,camera,renderer,loader;scene=new THREE.Scene,renderer=new THREE.WebGLRenderer,renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(renderer.domElement),loader=new THREE.JSONLoader,loader.load("assets/corridor.js",assetsLoaded);var keyboard=new THREEx.KeyboardState,Position=CES.Component.extend({name:"position",init:function(n,e,t){this.x=n,this.y=e,this.z=t}}),Destination=CES.Component.extend({name:"destination",init:function(n,e,t){this.x=n,this.y=e,this.z=t}}),Rotation=CES.Component.extend({name:"rotation",init:function(n,e,t){this.x=n,this.y=e,this.z=t}}),Appearance=CES.Component.extend({name:"appearance",init:function(n){this.mesh=n}}),Light=CES.Component.extend({name:"light",init:function(n){this.light=n}}),Player=CES.Component.extend({name:"player",init:function(n){this.camera=n}}),pawn=new CES.Entity;pawn.addComponent(new Position(0,0,0)),pawn.addComponent(new Player(new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3))),pawn.addComponent(new Light(new THREE.PointLight(16777215)));var corridor=new CES.Entity;corridor.addComponent(new Position(0,0,1)),corridor.addComponent(new Rotation(0,0,0));var PawnSystem=CES.System.extend({addedToWorld:function(n){var e=pawn.getComponent("position"),t=pawn.getComponent("player").camera,o=pawn.getComponent("light").light;t.position.z=e.z,t.rotation.y=Math.PI,o.position.z=e.z,scene.add(o)},update:function(n){var e=pawn.getComponent("position"),t=pawn.getComponent("player").camera,o=pawn.getComponent("light").light;if(pawn.hasComponent("destination")){var i=pawn.getComponent("destination");e.z<i.z?(e.z+=1*n,t.position.z=o.position.z=e.z):pawn.removeComponent("destination")}keyboard.pressed("w")&&pawn.hasComponent("destination")===!1&&(pawn.addComponent(new Destination(0,0,e.z+1)),e.z+=1*n,t.position.z=o.position.z=e.z)}}),RenderSystem=CES.System.extend({addedToWorld:function(n){n.entityAdded("appearance").add(function(n){var e=n.getComponent("position"),t=n.getComponent("rotation");mesh=n.getComponent("appearance").mesh,"undefined"!=typeof mesh&&(e&&(mesh.position.x=e.x,mesh.position.y=e.y,mesh.position.z=e.z),t&&(mesh.rotation.x=t.x,mesh.rotation.y=t.y,mesh.rotation.z=t.z),scene.add(mesh))})},update:function(n){renderer.render(scene,pawn.getComponent("player").camera)}}),world=new CES.World;world.addSystem(new PawnSystem),world.addSystem(new RenderSystem),world.addEntity(pawn),world.addEntity(corridor),window.requestAnimationFrame(frame);